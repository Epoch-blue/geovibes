# Evaluate Your Geospatial Model's Vibes

Yeah benchmarks are cool and stuff, but how are your model's vibes? With this tooling you'll hopefully be able to see!

## Prerequisites
First, there are some basic system requirements to take care of. Please refer to the linked documentation for installation.
1. `earthengine` python client library: https://developers.google.com/earth-engine/guides/python_install

Please make sure you are authenticated with these tools before starting.

GEE is only necessary if you want to generate NDVI and NDWI on the fly.

Before starting work, set up your local code environment. It is recommended to use `conda` or `mamba` to manage python dependencies.

```
mamba create -n geovibes python=3.12 -y
mamba activate geovibes
mamba install -c conda-forge --file ./requirements_v2.txt -y
```

## Get Embeddings 

As of now only the softcon embeddings generated by the Earth Genome are available for use. In the future we will be adding functionality for users to generate their own embeddings. If you would like to contribute compute/storage/general good vibes to this, please contact us at chris@demeterlabs.io

To pull the embeddings for an aoi, assuming you have a file called `aoi.geojson` and want to save the land-filtered embeddings to a directory called `aoi_embeddings` use the `region_to_embeddings.py` script, from the root directory of `geovibes` run:

```
python src/region_to_embeddings.py aoi.geojson --filter-land-only --mgrs-reference-file /geometries/MGRS_LAND.geojson --out-dir /aoi_embeddings
```
This will download the MGRS tile embeddings which overlap to your aoi, and filter them to only keep those that fall within a buffered version of your aoi.

## Build DuckDB Embeddings Database

Once you have your embeddings downloaded locally, use the `duckdb_embedding_index.py` script to generate a queryable, similarity searchable table. Default distance metric is cosine similarity.

```
python -m duckdb_embedding_index /aoi_embddings aoi.db
```

will produce a duckdb database with an an HSNW index built for similarity searching, and an RTree index built for fast spatial searching. I've benchmarked this with up to 10M vectors, and it can take ~ 1.5 hours to build. I'm still not sure how this scales though, because 5M vectors take around 10-15 minutes to build (??).

Things to investigate: duckdb FAISS extension, using duckdb as just the store and an external HSNW (FAISS/Annoy etc...), running an in-memory db (Qdrant) etc... if you want to contribute compute/storage/goodvibes to this effort, again contact chris@demeterlabs.io, or just fork the repo and go for it.

## Pipeline Steps

### 1. Interactive labeling of examples
The Geolabeler provides an interactive map interface for labeling geographic points. Key features:

- Interactive map with multiple basemap options (Maptiler satellite, RGB/HSV median composite, Google Hybrid). **Please note that the NDVI/NDWI are generated on the fly from GEE. The dates for this imagery should be set using the config.**
- Point and lasso selection modes for efficient labeling
- Positive/negative/erase labeling options
- Direct Google Maps linking for reference
- Automatic saving of labeled points as GeoJSON files

To launch the labeling interface, first set up your `config` file. An example is provided at `./config/ui_config.json`. Next, run the `duckdb_ei.ipynb` cells. Please use the python environment you set up earlier to run the notebook.

The outputs of this step will be a `parquet` of positive samples (and optionally negative samples) with the tile ID of the closest tile centroid as an identifier.
















